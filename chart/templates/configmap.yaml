apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "reflow-gateway.fullname" . }}
  labels:
    {{- include "reflow-gateway.labels" . | nindent 4 }}
data:
  config.yaml: |
    server:
      port: {{ .Values.config.server.port }}
      host: {{ .Values.config.server.host | quote }}

    database:
      host: {{ .Values.config.database.host | quote }}
      port: {{ .Values.config.database.port }}
      user: {{ .Values.config.database.user | quote }}
      password: ${DB_PASSWORD}
      database: {{ .Values.config.database.database | quote }}
      sslmode: {{ .Values.config.database.sslmode | quote }}

    jwt:
      secret: ${JWT_SECRET}

    cors:
      allowed_origins:
        {{- range .Values.config.cors.allowedOrigins }}
        - {{ . | quote }}
        {{- end }}
      allowed_headers:
        {{- range .Values.config.cors.allowedHeaders }}
        - {{ . | quote }}
        {{- end }}
      expose_headers:
        {{- range .Values.config.cors.exposeHeaders }}
        - {{ . | quote }}
        {{- end }}

    session:
      timeout: {{ .Values.config.session.timeout | quote }}
      cleanup_interval: {{ .Values.config.session.cleanupInterval | quote }}

    encryption:
      key: ${ENCRYPTION_KEY}

    logging:
      level: {{ .Values.config.logging.level | quote }}
      format: {{ .Values.config.logging.format | quote }}

    stdio:
      idle_ttl: {{ .Values.config.stdio.idleTtl | quote }}
      max_lifetime: {{ .Values.config.stdio.maxLifetime | quote }}
      gc_interval: {{ .Values.config.stdio.gcInterval | quote }}
      max_processes: {{ .Values.config.stdio.maxProcesses }}

    kubernetes:
      enabled: {{ .Values.config.kubernetes.enabled }}
      namespace: {{ .Values.config.kubernetes.namespace | quote }}
      kubeconfig: {{ .Values.config.kubernetes.kubeconfig | quote }}
      idle_ttl: {{ .Values.config.kubernetes.idleTtl | quote }}
      max_lifetime: {{ .Values.config.kubernetes.maxLifetime | quote }}
      gc_interval: {{ .Values.config.kubernetes.gcInterval | quote }}
      max_instances: {{ .Values.config.kubernetes.maxInstances }}

    telemetry:
      enabled: {{ .Values.config.telemetry.enabled }}
      endpoint: {{ .Values.config.telemetry.endpoint | quote }}
      service_name: {{ .Values.config.telemetry.serviceName | quote }}
      insecure: {{ .Values.config.telemetry.insecure }}
